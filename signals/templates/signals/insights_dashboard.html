{% extends 'base.html' %}
{% load static %}

{% block title %}AI Decision Intelligence Console - ZenithEdge{% endblock %}

{% block extra_css %}
<style>
    /* Professional Intelligence Console Color Palette */
    :root {
        --primary-blue: #1e3a5f;
        --steel-gray: #4a5568;
        --silver-accent: #cbd5e0;
        --insight-teal: #2c7a7b;
        --neutral-amber: #d69e2e;
        --background-dark: #1a202c;
        --text-light: #e2e8f0;
    }
    
    body {
        background-color: #f7fafc;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    /* Insight Snapshot Card */
    .insight-snapshot-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-left: 4px solid var(--primary-blue);
        transition: all 0.3s ease;
    }
    
    .insight-snapshot-card:hover {
        box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        transform: translateY(-2px);
    }
    
    .insight-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .insight-symbol {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary-blue);
    }
    
    .insight-meta {
        display: flex;
        gap: 12px;
        font-size: 13px;
        color: var(--steel-gray);
    }
    
    .insight-meta span {
        background: #f7fafc;
        padding: 4px 12px;
        border-radius: 6px;
    }
    
    /* Bias Badge (NO DIRECTIONAL COLORS) */
    .bias-badge {
        display: inline-block;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .bias-bearish {
        background-color: rgba(214, 158, 46, 0.15);
        color: var(--neutral-amber);
    }
    
    .bias-neutral {
        background-color: rgba(74, 85, 104, 0.15);
        color: var(--steel-gray);
    }
    
    .bias-bullish {
        background-color: rgba(44, 122, 123, 0.15);
        color: var(--insight-teal);
    }
    
    /* Market Narrative */
    .insight-narrative {
        margin: 20px 0;
        padding: 20px;
        background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
        border-radius: 8px;
        line-height: 1.7;
        color: #2d3748;
    }
    
    .insight-narrative::before {
        content: "üß≠";
        font-size: 24px;
        margin-right: 8px;
    }
    
    /* Metrics Bar */
    .insight-metrics {
        display: flex;
        justify-content: space-between;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e2e8f0;
    }
    
    .metric-item {
        text-align: center;
    }
    
    .metric-label {
        font-size: 12px;
        color: var(--steel-gray);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
    }
    
    .metric-value {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary-blue);
    }
    
    /* Confidence Meter */
    .confidence-meter {
        width: 100%;
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 8px;
    }
    
    .confidence-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--insight-teal), var(--primary-blue));
        transition: width 0.5s ease;
    }
    
    /* Follow-up Cue */
    .follow-up-cue {
        margin-top: 16px;
        padding: 12px 16px;
        background: #fff5e6;
        border-left: 3px solid var(--neutral-amber);
        border-radius: 6px;
        font-size: 14px;
        color: #744210;
    }
    
    /* Page Header */
    .page-header {
        background: linear-gradient(135deg, var(--primary-blue) 0%, #2d4a6d 100%);
        color: white;
        padding: 40px 0;
        margin-bottom: 40px;
    }
    
    .page-title {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 8px;
    }
    
    .page-subtitle {
        font-size: 16px;
        opacity: 0.9;
    }
    
    /* Filter Bar */
    .filter-bar {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .filter-bar select, .filter-bar input {
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 8px 12px;
        margin-right: 12px;
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--steel-gray);
    }
    
    .empty-state-icon {
        font-size: 64px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1 class="page-title">üß† AI Decision Intelligence Console</h1>
        <p class="page-subtitle">Market interpretation and contextual analysis powered by ZenithEdge AI</p>
    </div>
</div>

<div class="container">
    <!-- Filter Bar -->
    <div class="filter-bar">
        <form method="GET" class="row align-items-end">
            <div class="col-md-2">
                <label class="form-label">Symbol</label>
                <input type="text" name="symbol" class="form-control" placeholder="e.g., GBPJPY" value="{{ request.GET.symbol }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Market Bias</label>
                <select name="bias" class="form-select">
                    <option value="">All Biases</option>
                    <option value="bearish" {% if request.GET.bias == 'bearish' %}selected{% endif %}>Bearish</option>
                    <option value="neutral" {% if request.GET.bias == 'neutral' %}selected{% endif %}>Neutral</option>
                    <option value="bullish" {% if request.GET.bias == 'bullish' %}selected{% endif %}>Bullish</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Market Phase</label>
                <select name="market_phase" class="form-select">
                    <option value="">All Phases</option>
                    <option value="accumulation" {% if request.GET.market_phase == 'accumulation' %}selected{% endif %}>Accumulation</option>
                    <option value="expansion" {% if request.GET.market_phase == 'expansion' %}selected{% endif %}>Expansion</option>
                    <option value="manipulation" {% if request.GET.market_phase == 'manipulation' %}selected{% endif %}>Manipulation</option>
                    <option value="distribution" {% if request.GET.market_phase == 'distribution' %}selected{% endif %}>Distribution</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Min. Insight Index</label>
                <input type="number" name="min_insight_index" class="form-control" min="0" max="100" value="{{ request.GET.min_insight_index|default:'0' }}">
            </div>
            <div class="col-md-2">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="high_quality_only" {% if request.GET.high_quality_only %}checked{% endif %}>
                    <label class="form-check-label">High Quality Only</label>
                </div>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
            </div>
        </form>
    </div>
    
    <!-- Insights List -->
    {% if insights %}
        {% for insight in insights %}
        <div class="insight-snapshot-card">
            <!-- Header -->
            <div class="insight-header">
                <div>
                    <span class="insight-symbol">{{ insight.symbol }}</span>
                    <span class="bias-badge bias-{{ insight.bias }}">{{ insight.bias|upper }}</span>
                </div>
                <div class="insight-meta">
                    <span>‚è±Ô∏è {{ insight.timeframe }}</span>
                    <span>üìä {{ insight.regime }}</span>
                    <span>üåç {{ insight.session }}</span>
                    <span>üïê {{ insight.received_at|timesince }} ago</span>
                </div>
            </div>
            
            <!-- Market Narrative -->
            <div class="insight-narrative">
                {{ insight.narrative }}
            </div>
            
            <!-- Follow-up Cue -->
            {% if insight.follow_up_cue %}
            <div class="follow-up-cue">
                <strong>üí° Observation Cue:</strong> {{ insight.follow_up_cue }}
            </div>
            {% endif %}
            
            <!-- Metrics -->
            <div class="insight-metrics">
                <div class="metric-item">
                    <div class="metric-label">üß† Confidence</div>
                    <div class="metric-value">{{ insight.confidence_score|floatformat:0 }}%</div>
                    <div class="confidence-meter">
                        <div class="confidence-fill" style="width: {{ insight.confidence_score }}%"></div>
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">üìà Insight Index</div>
                    <div class="metric-value">{{ insight.insight_index|floatformat:0 }}/100</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">üåä Market Phase</div>
                    <div class="metric-value" style="font-size: 14px; text-transform: capitalize;">{{ insight.market_phase }}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">üìç Observation Price</div>
                    <div class="metric-value" style="font-size: 16px;">{{ insight.observation_price|floatformat:5 }}</div>
                </div>
            </div>
        </div>
        {% endfor %}
        
        <!-- Pagination -->
        {% if is_paginated %}
        <nav aria-label="Insights pagination">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1">First</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                </li>
                {% endif %}
                
                <li class="page-item active">
                    <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
                </li>
                
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-state-icon">üîç</div>
            <h3>No Market Insights Found</h3>
            <p>No insights match your current filters. Try adjusting your filter criteria or check back later for new analysis.</p>
        </div>
    {% endif %}
</div>
{% endblock %}

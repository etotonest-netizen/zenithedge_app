{% extends 'admin_dashboard/base_module.html' %}

{% block title %}Signals Management - Admin Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h2><i class="bi bi-broadcast"></i> Signals Management</h2>
            <p class="text-muted mb-0">View and manage all trading signals</p>
        </div>
        <a href="{% url 'admin_dashboard:dashboard' %}" class="btn btn-outline-light">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>

<!-- Statistics -->
<div class="stats-bar">
    <div class="stat-card">
        <i class="bi bi-broadcast stat-icon text-info"></i>
        <div class="stat-content">
            <h3>{{ total_count }}</h3>
            <p>Total Signals</p>
        </div>
    </div>
    <div class="stat-card">
        <i class="bi bi-check-circle stat-icon text-success"></i>
        <div class="stat-content">
            <h3>{{ allowed_count }}</h3>
            <p>Allowed</p>
        </div>
    </div>
    <div class="stat-card">
        <i class="bi bi-x-circle stat-icon text-danger"></i>
        <div class="stat-content">
            <h3>{{ blocked_count }}</h3>
            <p>Blocked</p>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="filter-bar">
    <form method="GET" class="d-flex gap-3 w-100">
        <select name="status" class="form-select" style="max-width: 200px;" onchange="this.form.submit()">
            <option value="all" {% if filter_status == 'all' %}selected{% endif %}>All Signals</option>
            <option value="allowed" {% if filter_status == 'allowed' %}selected{% endif %}>Allowed Only</option>
            <option value="blocked" {% if filter_status == 'blocked' %}selected{% endif %}>Blocked Only</option>
            <option value="risk_blocked" {% if filter_status == 'risk_blocked' %}selected{% endif %}>Risk Blocked</option>
        </select>
    </form>
</div>

<!-- Signals Table -->
<div class="data-table-container">
    <div class="table-responsive">
        <table class="table table-dark table-hover mb-0">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Symbol</th>
                    <th>Side</th>
                    <th>Strategy</th>
                    <th>Timeframe</th>
                    <th>Price</th>
                    <th>SL/TP</th>
                    <th>Confidence</th>
                    <th>Status</th>
                    <th>User</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {% for signal in signals %}
                <tr>
                    <td><strong>#{{ signal.id }}</strong></td>
                    <td><span class="badge bg-primary">{{ signal.symbol }}</span></td>
                    <td>
                        {% if signal.side == 'long' %}
                            <span class="badge bg-success"><i class="bi bi-arrow-up"></i> LONG</span>
                        {% else %}
                            <span class="badge bg-danger"><i class="bi bi-arrow-down"></i> SHORT</span>
                        {% endif %}
                    </td>
                    <td>{{ signal.strategy|truncatechars:20 }}</td>
                    <td><span class="badge bg-secondary">{{ signal.timeframe }}</span></td>
                    <td><strong>{{ signal.price }}</strong></td>
                    <td>
                        <small class="text-success">SL: {{ signal.sl }}</small><br>
                        <small class="text-info">TP: {{ signal.tp }}</small>
                    </td>
                    <td>
                        {% if signal.confidence >= 8 %}
                            <span class="badge bg-success">{{ signal.confidence }}/10</span>
                        {% elif signal.confidence >= 6 %}
                            <span class="badge bg-warning">{{ signal.confidence }}/10</span>
                        {% else %}
                            <span class="badge bg-danger">{{ signal.confidence }}/10</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if signal.is_allowed and not signal.is_risk_blocked %}
                            <span class="badge bg-success"><i class="bi bi-check-circle"></i> Allowed</span>
                        {% elif signal.is_risk_blocked %}
                            <span class="badge bg-warning"><i class="bi bi-shield-exclamation"></i> Risk Blocked</span>
                        {% else %}
                            <span class="badge bg-danger"><i class="bi bi-x-circle"></i> Blocked</span>
                        {% endif %}
                    </td>
                    <td>{{ signal.user.email|truncatechars:20 }}</td>
                    <td>
                        <small>{{ signal.received_at|date:"M d, H:i" }}</small>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="11" class="text-center py-5">
                        <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                        <p class="mt-3 text-muted">No signals found</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="mt-3 text-muted">
    Showing {{ signals|length }} signals
</div>
{% endblock %}

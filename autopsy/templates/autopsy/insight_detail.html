<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insight Detail - Zenith Market Analyst</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #1e3a5f;
            --steel-gray: #4a5568;
            --insight-teal: #2c7a7b;
            --success-green: #48bb78;
            --danger-red: #f56565;
            --warning-amber: #f59e0b;
            --exceptional-green: #10b981;
            --high-blue: #3b82f6;
            --moderate-amber: #f59e0b;
            --low-red: #ef4444;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .detail-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .back-button {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: white;
            color: var(--primary-blue);
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .back-button:hover {
            background: var(--primary-blue);
            color: white;
            transform: translateX(-4px);
        }
        
        .insight-detail-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-bottom: 30px;
        }
        
        .insight-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .header-left h1 {
            color: var(--primary-blue);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .metadata-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .badge {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
        }
        
        .badge-symbol {
            background: var(--primary-blue);
            color: white;
        }
        
        .badge-timeframe {
            background: var(--insight-teal);
            color: white;
        }
        
        .badge-regime {
            color: white;
        }
        
        .regime-trending { background: var(--exceptional-green); }
        .regime-ranging { background: var(--warning-amber); }
        .regime-volatile { background: var(--danger-red); }
        .regime-consolidation { background: var(--high-blue); }
        
        .badge-structure {
            background: #8b5cf6;
            color: white;
        }
        
        .badge-session {
            background: var(--steel-gray);
            color: white;
        }
        
        .insight-index-display {
            text-align: center;
        }
        
        .index-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            font-weight: 700;
            color: white;
            margin: 0 auto 15px;
        }
        
        .index-exceptional { background: linear-gradient(135deg, var(--exceptional-green), #059669); }
        .index-high { background: linear-gradient(135deg, var(--high-blue), #2563eb); }
        .index-moderate { background: linear-gradient(135deg, var(--moderate-amber), #d97706); }
        .index-low { background: linear-gradient(135deg, var(--low-red), #dc2626); }
        
        .quality-label {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .insight-content {
            margin: 30px 0;
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--steel-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }
        
        .insight-text-large {
            font-size: 20px;
            line-height: 1.7;
            color: var(--primary-blue);
            font-weight: 500;
            background: #f7fafc;
            padding: 24px;
            border-radius: 12px;
            border-left: 4px solid var(--primary-blue);
            margin-bottom: 25px;
        }
        
        .suggestion-large {
            background: #fff5e6;
            border-left: 4px solid var(--warning-amber);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        
        .suggestion-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .suggestion-text-large {
            font-size: 18px;
            color: var(--steel-gray);
            font-weight: 500;
        }
        
        .news-alert-large {
            background: #fee;
            border-left: 4px solid var(--danger-red);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        
        .news-impact-large {
            font-size: 12px;
            font-weight: 700;
            color: var(--danger-red);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .news-text-large {
            font-size: 16px;
            color: #721c24;
        }
        
        .score-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .score-card {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .score-name {
            font-size: 12px;
            font-weight: 700;
            color: var(--steel-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }
        
        .score-value-large {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .score-bar-large {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .score-bar-fill-large {
            height: 100%;
            background: linear-gradient(90deg, var(--exceptional-green), var(--high-blue));
            transition: width 0.3s ease;
        }
        
        .chart-labels-section {
            background: #f7fafc;
            border-radius: 12px;
            padding: 24px;
            margin: 25px 0;
        }
        
        .chart-label-large {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            border: 2px solid currentColor;
            margin-right: 12px;
            margin-bottom: 12px;
            display: inline-block;
        }
        
        .label-structure { color: #8b5cf6; background: #f3f0ff; }
        .label-regime { color: var(--success-green); background: #f0fff4; }
        .label-momentum { color: var(--high-blue); background: #eff6ff; }
        .label-volume { color: var(--warning-amber); background: #fffbeb; }
        
        .metadata-table {
            width: 100%;
            margin: 25px 0;
        }
        
        .metadata-table tr {
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metadata-table td {
            padding: 12px 0;
        }
        
        .metadata-label {
            font-weight: 700;
            color: var(--steel-gray);
            width: 200px;
        }
        
        .metadata-value {
            color: var(--primary-blue);
        }
        
        .related-insights {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .related-insights h2 {
            color: var(--primary-blue);
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .related-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 3px solid var(--insight-teal);
            transition: all 0.2s;
        }
        
        .related-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateX(4px);
        }
        
        .related-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .related-timestamp {
            font-size: 13px;
            color: #718096;
        }
        
        .related-index {
            font-weight: 700;
            font-size: 16px;
            padding: 6px 12px;
            border-radius: 6px;
            color: white;
        }
        
        .related-text {
            font-size: 15px;
            color: var(--primary-blue);
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .insight-header {
                flex-direction: column;
            }
            
            .score-grid {
                grid-template-columns: 1fr;
            }
            
            .metadata-table {
                font-size: 14px;
            }
            
            .metadata-label {
                width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="detail-container">
        <a href="{% url 'autopsy:market_analyst' %}" class="back-button">‚Üê Back to Market Analyst</a>
        
        <!-- Main Insight Card -->
        <div class="insight-detail-card">
            <div class="insight-header">
                <div class="header-left">
                    <h1>Market Insight #{{ insight.id }}</h1>
                    <div class="metadata-badges">
                        <span class="badge badge-symbol">{{ insight.symbol }}</span>
                        <span class="badge badge-timeframe">{{ insight.timeframe }}</span>
                        <span class="badge badge-regime regime-{{ insight.regime }}">{{ insight.get_regime_display }}</span>
                        <span class="badge badge-structure">{{ insight.get_structure_display }}</span>
                        <span class="badge badge-session">{{ insight.get_session_display }}</span>
                    </div>
                </div>
                
                <div class="insight-index-display">
                    <div class="index-circle index-{{ quality_label|lower|cut:' ' }}">
                        {{ insight.insight_index }}
                    </div>
                    <div class="quality-label" style="color: {{ color_code }}">
                        {{ quality_label }}
                    </div>
                </div>
            </div>
            
            <!-- Insight Content -->
            <div class="insight-content">
                <div class="section-title">üìä Market Analysis</div>
                <div class="insight-text-large">
                    {{ insight.insight_text }}
                </div>
                
                {% if insight.suggestion %}
                <div class="section-title">üí° Actionable Guidance</div>
                <div class="suggestion-large">
                    <div class="suggestion-icon">üí°</div>
                    <div class="suggestion-text-large">{{ insight.suggestion }}</div>
                </div>
                {% endif %}
                
                {% if insight.news_impact and insight.news_impact != 'none' %}
                <div class="section-title">‚ö†Ô∏è News Awareness</div>
                <div class="news-alert-large">
                    <div class="news-impact-large">{{ insight.news_impact|upper }} IMPACT EVENT</div>
                    <div class="news-text-large">{{ insight.news_context }}</div>
                </div>
                {% endif %}
            </div>
            
            <!-- Score Breakdown -->
            <div class="section-title">üìà Quality Score Breakdown</div>
            <div class="score-grid">
                <div class="score-card">
                    <div class="score-name">Structure Clarity</div>
                    <div class="score-value-large" style="color: {% if insight.structure_clarity >= 70 %}var(--success-green){% elif insight.structure_clarity >= 50 %}var(--warning-amber){% else %}var(--danger-red){% endif %}">
                        {{ insight.structure_clarity }}
                    </div>
                    <div class="score-bar-large">
                        <div class="score-bar-fill-large" style="width: {{ insight.structure_clarity }}%"></div>
                    </div>
                </div>
                
                <div class="score-card">
                    <div class="score-name">Regime Stability</div>
                    <div class="score-value-large" style="color: {% if insight.regime_stability >= 70 %}var(--success-green){% elif insight.regime_stability >= 50 %}var(--warning-amber){% else %}var(--danger-red){% endif %}">
                        {{ insight.regime_stability }}
                    </div>
                    <div class="score-bar-large">
                        <div class="score-bar-fill-large" style="width: {{ insight.regime_stability }}%"></div>
                    </div>
                </div>
                
                <div class="score-card">
                    <div class="score-name">Volume Quality</div>
                    <div class="score-value-large" style="color: {% if insight.volume_quality >= 70 %}var(--success-green){% elif insight.volume_quality >= 50 %}var(--warning-amber){% else %}var(--danger-red){% endif %}">
                        {{ insight.volume_quality }}
                    </div>
                    <div class="score-bar-large">
                        <div class="score-bar-fill-large" style="width: {{ insight.volume_quality }}%"></div>
                    </div>
                </div>
                
                <div class="score-card">
                    <div class="score-name">Momentum Alignment</div>
                    <div class="score-value-large" style="color: {% if insight.momentum_alignment >= 70 %}var(--success-green){% elif insight.momentum_alignment >= 50 %}var(--warning-amber){% else %}var(--danger-red){% endif %}">
                        {{ insight.momentum_alignment }}
                    </div>
                    <div class="score-bar-large">
                        <div class="score-bar-fill-large" style="width: {{ insight.momentum_alignment }}%"></div>
                    </div>
                </div>
                
                <div class="score-card">
                    <div class="score-name">Session Validity</div>
                    <div class="score-value-large" style="color: {% if insight.session_validity >= 70 %}var(--success-green){% elif insight.session_validity >= 50 %}var(--warning-amber){% else %}var(--danger-red){% endif %}">
                        {{ insight.session_validity }}
                    </div>
                    <div class="score-bar-large">
                        <div class="score-bar-fill-large" style="width: {{ insight.session_validity }}%"></div>
                    </div>
                </div>
                
                <div class="score-card">
                    <div class="score-name">Risk Level</div>
                    <div class="score-value-large" style="color: {% if insight.risk_level >= 70 %}var(--success-green){% elif insight.risk_level >= 50 %}var(--warning-amber){% else %}var(--danger-red){% endif %}">
                        {{ insight.risk_level }}
                    </div>
                    <div class="score-bar-large">
                        <div class="score-bar-fill-large" style="width: {{ insight.risk_level }}%"></div>
                    </div>
                </div>
            </div>
            
            <!-- Chart Labels -->
            {% if insight.chart_labels %}
            <div class="section-title">üè∑Ô∏è TradingView Chart Labels</div>
            <div class="chart-labels-section">
                {% for key, value in insight.chart_labels.items %}
                <span class="chart-label-large label-{{ key }}">{{ value }}</span>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Metadata Table -->
            <div class="section-title">üìã Technical Metadata</div>
            <table class="metadata-table">
                <tr>
                    <td class="metadata-label">Timestamp</td>
                    <td class="metadata-value">{{ insight.timestamp|date:"M d, Y H:i:s" }}</td>
                </tr>
                <tr>
                    <td class="metadata-label">Symbol</td>
                    <td class="metadata-value">{{ insight.symbol }}</td>
                </tr>
                <tr>
                    <td class="metadata-label">Timeframe</td>
                    <td class="metadata-value">{{ insight.timeframe }}</td>
                </tr>
                <tr>
                    <td class="metadata-label">Market Regime</td>
                    <td class="metadata-value">{{ insight.get_regime_display }}</td>
                </tr>
                <tr>
                    <td class="metadata-label">Market Structure</td>
                    <td class="metadata-value">{{ insight.get_structure_display }}</td>
                </tr>
                <tr>
                    <td class="metadata-label">Momentum State</td>
                    <td class="metadata-value">{{ insight.get_momentum_display }}</td>
                </tr>
                <tr>
                    <td class="metadata-label">Volume State</td>
                    <td class="metadata-value">{{ insight.get_volume_state_display }}</td>
                </tr>
                <tr>
                    <td class="metadata-label">Trading Session</td>
                    <td class="metadata-value">{{ insight.get_session_display }}</td>
                </tr>
                <tr>
                    <td class="metadata-label">Vocabulary Hash</td>
                    <td class="metadata-value"><code>{{ insight.vocabulary_hash }}</code></td>
                </tr>
            </table>
        </div>
        
        <!-- Related Insights -->
        {% if related_insights %}
        <div class="related-insights">
            <h2>Related Insights (within 4-hour window)</h2>
            {% for related in related_insights %}
            <a href="{% url 'autopsy:insight_detail' related.id %}" style="text-decoration: none;">
                <div class="related-card">
                    <div class="related-header">
                        <div>
                            <span class="badge badge-symbol">{{ related.symbol }}</span>
                            <span class="badge badge-regime regime-{{ related.regime }}">{{ related.get_regime_display }}</span>
                        </div>
                        <div>
                            <span class="related-timestamp">{{ related.timestamp|date:"M d, H:i" }}</span>
                            <span class="related-index" style="background: {% if related.insight_index >= 80 %}var(--exceptional-green){% elif related.insight_index >= 65 %}var(--high-blue){% elif related.insight_index >= 50 %}var(--moderate-amber){% else %}var(--low-red){% endif %}">
                                {{ related.insight_index }}
                            </span>
                        </div>
                    </div>
                    <div class="related-text">{{ related.insight_text|truncatewords:20 }}</div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</body>
</html>
